### ðŸ“‘ ã“ã‚Œã¾ã§ã«åˆæ„ã—ãŸ **ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ»ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶ã¾ã¨ã‚**

---

## 1. ã‚³ã‚¢æ¦‚å¿µ

| æ¦‚å¿µ                 | èª¬æ˜Ž                                                                  |
| ------------------ | ------------------------------------------------------------------- |
| **playerRating**   | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å®ŸåŠ›å€¤ï¼ˆåˆæœŸ 1500ï¼‰                                                  |
| **photoRating**    | å†™çœŸã®é›£æ˜“åº¦å€¤ï¼ˆåˆæœŸ 1500 ãªã©ï¼‰                                                 |
| **score**          | 1 å›žã®ãƒ—ãƒ¬ã‚¤ã§å¾—ãŸã‚¹ã‚³ã‚¢ï¼ˆè·é›¢ã‚„ç‚¹æ•°ã§æ±ºå®šï¼‰                                             |
| **avgScore (å†™çœŸå´)** | å†™çœŸã®ç¾åœ¨ã®å¹³å‡ã‚¹ã‚³ã‚¢                                           |
| **result**         | å‹æ•—ãƒ•ãƒ©ã‚°ï¼š`1 = score > avgScore`, `0.5 = Â±è¨±å®¹ç¯„å›²`, `0 = score < avgScore` |

---

## 2. ãƒ¬ãƒ¼ãƒ†ã‚£ãƒ³ã‚°æ›´æ–°å¼ï¼ˆElo åŽŸç†ï¼‰

```ts
// æœŸå¾…å‹çŽ‡ï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼è¦–ç‚¹ï¼‰
const expected = 1 / (1 + 10 ** ((photoRating - playerRating) / 400));

// å‹•çš„ K ä¿‚æ•°ï¼ˆä¸Šç´šè€…ã»ã©å°ã•ãï¼‰
function dynamicK(r: number) {
  if (r < 1600) return 32;
  if (r < 2000) return 24;
  return 16;            // é«˜ãƒ¬ãƒ¼ãƒˆå¸¯
}

// ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ›´æ–°
playerRating += dynamicK(playerRating) * (result - expected);

// å†™çœŸå´ã‚‚é€†æ–¹å‘ã§æ›´æ–°
const photoExpected = 1 / (1 + 10 ** ((playerRating - photoRating) / 400));
photoRating += dynamicK(photoRating) * ((1 - result) - photoExpected);
```

### åŠ¹æžœ

* **å¼·ã„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ Ã— ç°¡å˜å†™çœŸ**

  * å‹ã£ã¦ã‚‚ +æ•° ptã€è² ã‘ã‚‹ã¨ âˆ’æ•°å pt
* **é«˜é›£åº¦å†™çœŸã§æˆåŠŸ**

  * æœŸå¾…å€¤ãŒä½Žã„ã®ã§ +10ã€œ20 pt ãªã©å¤§å¹…å¢—

---

## 3. ã‚¤ãƒ³ãƒ•ãƒ¬æŠ‘åˆ¶ç­–

1. **K ä¿‚æ•°æ®µéšŽåˆ¶**

   * `1600 æœªæº€: 32`, `1600â€“1999: 24`, `2000 ä»¥ä¸Š: 16`
2. **ãƒ¬ãƒ¼ãƒˆä¸Šé™**

   * ä¾‹ï¼š`maxRating = 2500`
3. **æœŸé–“å†…ä¸Šæ˜‡å¹…åˆ¶é™**

   * ä¾‹ï¼šåŒä¸€ãƒ¦ãƒ¼ã‚¶ãƒ¼ `ï¼‹100 pt / day` ã§ã‚¯ãƒªãƒƒãƒ—
4. **ã‚·ãƒ¼ã‚ºãƒ³åˆ¶ï¼æ¸›è¡°**ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

   * æœŸæœ«ã«å…¨å“¡ã‚’å¹³å‡ã¸åŽæŸ or æœªãƒ—ãƒ¬ã‚¤æ¸›è¡°

---

## 4. å‹æ•—åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯

```ts
// è¨±å®¹å¹…ã‚’ Â±Î´% ã«ã—ã¦å¼•ãåˆ†ã‘ã‚’è¨­å®šã—ã¦ã‚‚ã‚ˆã„
if (score > avgScore * (1 + delta))      result = 1;
else if (score < avgScore * (1 - delta)) result = 0;
else                                     result = 0.5;
```

* **delta** ä¾‹ï¼š`0.02`ï¼ˆÂ±2% ä»¥å†…ã¯å¼•ãåˆ†ã‘ï¼‰

---

ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆï¼ˆæœ€å°æ§‹æˆï¼‰

| ãƒ†ãƒ¼ãƒ–ãƒ«        | ä¸»ãªã‚«ãƒ©ãƒ                                                                                            |
| ----------- | ----------------------------------------------------------------------------------------------- |
| **players** | `id (UUID)`, `name`, `rating INT`, `rating_last_updated TIMESTAMP`                              |
| **photos**  | `id (UUID)`, `avg_score FLOAT`, `play_count INT`, `rating INT`, `rating_last_updated TIMESTAMP` |
| **guesses** | `id`, `player_id FK`, `photo_id FK`, `score FLOAT`, `created_at TIMESTAMP`                      |

* **DB ãƒˆãƒªã‚¬** or **API Route** ã§ `guesses` è¿½åŠ æ™‚ã«

  1. `avg_score, play_count` æ›´æ–°
  2. ä¸Šè¨˜ Elo å¼ã§åŒæ–¹ã® `rating` æ›´æ–°
  3. ã‚¯ãƒªãƒƒãƒ—ï¼ˆä¸Šé™ãƒ»æ—¥æ¬¡å¢—åˆ†ãƒã‚§ãƒƒã‚¯ï¼‰

---

## 6. API ãƒ«ãƒ¼ãƒˆ (Next.js) æ¦‚è¦

```
POST /api/submit-guess
{
  playerId,
  photoId,
  score
}
â†“
â€¢ å†™çœŸã®å¹³å‡ç‚¹ãƒ»play_count å–å¾—ãƒ»æ›´æ–°
â€¢ å‹æ•—åˆ¤å®š â†’ result
â€¢ playerRating, photoRating ã‚’ Elo å¼ã§å†è¨ˆç®—
â€¢ å¤‰å‹•å¾Œã®å€¤ã‚’ players / photos ãƒ†ãƒ¼ãƒ–ãƒ«ã¸ä¿å­˜
â€¢ ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã§æ–°ãƒ¬ãƒ¼ãƒˆã¨ photoRating ã‚’è¿”å´
```

---

ã“ã®ã¾ã¨ã‚ã‚’åŸºã« **å®Ÿè£…ã‚µãƒ³ãƒ—ãƒ«** ã‚„ **è©³ç´°è¨­è¨ˆ** ãŒå¿…è¦ã«ãªã£ãŸã‚‰ã€ã„ã¤ã§ã‚‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¦ãã ã•ã„ ðŸš€
